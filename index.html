import React, { useState, useRef } from 'react';

// Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ© Ù„Ù„Ø¨ÙŠØ¦Ø© ÙˆØ§Ù„Ø£Ø¨Ø¹Ø§Ø¯
const LIGHTING_MODES = [
  { id: 'urban', label: 'ğŸ™ï¸ Ù†Ù‡Ø§Ø± Ù…Ø¯Ù†ÙŠ' },
  { id: 'nature', label: 'ğŸŒ² Ø¨ÙŠØ¦Ø© Ø·Ø¨ÙŠØ¹ÙŠØ©' },
  { id: 'studio', label: 'ğŸ  Ø¥Ø¶Ø§Ø¡Ø© Ø§Ø³ØªÙˆØ¯ÙŠÙˆ' },
  { id: 'night', label: 'ğŸŒ™ Ù…Ø´Ù‡Ø¯ Ù„ÙŠÙ„ÙŠ' },
];

const ASPECT_RATIOS = {
  '1:1': 'aspect-square',
  '16:9': 'aspect-video',
  '4:3': 'aspect-[4/3]'
};

type RatioKey = keyof typeof ASPECT_RATIOS;

export default function AvantgardFinalApp() {
  const [source, setSource] = useState<string | null>(null);
  const [output, setOutput] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const fileInput = useRef<HTMLInputElement>(null);

  const [params, setParams] = useState({
    smartPrompt: '',
    lighting: 'urban',
    ratio: '1:1' as RatioKey,
    creativity: 80
  });

  const onSelectFile = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (ev) => setSource(ev.target?.result as string);
      reader.readAsDataURL(file);
    }
  };

  const handleRender = () => {
    if (!source) return alert("ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹");
    setIsLoading(true);
    // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¨Ù€ Google AI Studio
    setTimeout(() => {
      setOutput(source); 
      setIsLoading(false);
    }, 3800);
  };

  return (
    <div className="flex flex-col lg:flex-row min-h-screen bg-[#05070a] text-gray-200" dir="rtl">
      
      {/* Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù†: Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© */}
      <aside className="w-full lg:w-[390px] bg-[#0d1117] border-b lg:border-l border-gray-800 p-6 flex flex-col gap-6 overflow-y-auto lg:h-screen">
        <div className="text-center border-b border-gray-800 pb-5">
          <h1 className="text-2xl font-black text-white italic tracking-tighter">AVANTGARD AI</h1>
          <p className="text-[9px] text-blue-500 font-bold tracking-[0.3em] uppercase mt-1">Professional Architecture Engine</p>
        </div>

        {/* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø°ÙƒÙŠØ© (Smart Edit) */}
        <div className="space-y-2">
          <label className="text-[11px] font-bold text-gray-500 uppercase tracking-wider">ğŸª„ Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ</label>
          <textarea 
            value={params.smartPrompt}
            onChange={(e) => setParams({...params, smartPrompt: e.target.value})}
            placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ…Ø§ØªÙƒ Ù‡Ù†Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø±Ù†Ø¯Ø±... (Ù…Ø«Ù„Ø§Ù‹: Ø£Ø¶Ù Ø²Ø¬Ø§Ø¬Ø§Ù‹ Ø¹Ø§ÙƒØ³Ø§Ù‹ØŒ ØºÙŠØ± Ù„ÙˆÙ† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©)"
            className="w-full h-32 bg-[#05070a] border border-gray-800 rounded-2xl p-4 text-xs focus:border-blue-500 outline-none transition-all placeholder:text-gray-700"
          />
        </div>

        {/* ÙˆØ¶Ø¹ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© HDRI */}
        <div className="space-y-2">
          <label className="text-[11px] font-bold text-gray-500 uppercase tracking-wider">ÙˆØ¶Ø¹ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© (HDRI)</label>
          <div className="grid grid-cols-2 gap-2">
            {LIGHTING_MODES.map((m) => (
              <button
                key={m.id}
                onClick={() => setParams({...params, lighting: m.id})}
                className={`p-3 text-[10px] font-bold rounded-xl border transition-all ${params.lighting === m.id ? 'border-blue-600 bg-blue-600/10 text-white shadow-lg' : 'border-gray-800 bg-[#161b22] text-gray-500'}`}
              >
                {m.label}
              </button>
            ))}
          </div>
        </div>

        {/* Ù‡Ø§Ù…Ø´ Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ */}
        <div className="bg-[#161b22] p-4 rounded-2xl border border-gray-800">
          <label className="text-[11px] font-bold text-gray-500 block mb-3 uppercase tracking-wider">Ù‡Ø§Ù…Ø´ Ø§Ù„ØªØµØ±Ù Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ</label>
          <input 
            type="range" 
            className="w-full accent-blue-600"
            value={params.creativity}
            onChange={(e) => setParams({...params, creativity: parseInt(e.target.value)})}
          />
          <div className="flex justify-between text-[9px] mt-2 font-black italic">
            <span className="text-blue-500">Ø§Ù„ØªØ²Ø§Ù… Ø¯Ù‚ÙŠÙ‚</span>
            <span className="text-gray-600">Ø®ÙŠØ§Ù„ Ø­Ø±</span>
          </div>
        </div>

        {/* Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ØµÙˆØ±Ø© */}
        <div className="space-y-2">
          <label className="text-[11px] font-bold text-gray-500 uppercase tracking-wider">Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø±Ù†Ø¯Ø±</label>
          <div className="grid grid-cols-3 gap-2">
            {(Object.keys(ASPECT_RATIOS) as RatioKey[]).map((r) => (
              <button
                key={r}
                onClick={() => setParams({...params, ratio: r})}
                className={`p-2 text-[10px] font-bold rounded-lg border transition-all ${params.ratio === r ? 'border-blue-600 bg-blue-600/20 text-white' : 'border-gray-800 bg-[#05070a]'}`}
              >
                {r}
              </button>
            ))}
          </div>
        </div>

        <button 
          onClick={handleRender}
          className="w-full bg-blue-600 hover:bg-blue-500 text-white py-4 rounded-2xl font-black text-sm shadow-2xl active:scale-95 transition-all mt-auto mb-4"
        >
          ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ù†Ø¯Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        </button>
      </aside>

      {/* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø¨Ø¹ÙŠÙ† */}
      <main className="flex-1 overflow-y-auto p-4 lg:p-12 bg-[#010409]">
        <div className="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16 items-start">
          
          {/* Ø§Ù„Ù…Ø±Ø¨Ø¹ 1: Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ */}
          <div className="space-y-4">
            <h3 className="text-[11px] font-black text-gray-600 uppercase tracking-[0.4em]">01. SOURCE PROJECT</h3>
            <div 
              onClick={() => fileInput.current?.click()}
              className={`relative rounded-[2.5rem] lg:rounded-[3.5rem] border-2 border-dashed flex items-center justify-center overflow-hidden transition-all duration-700 ${ASPECT_RATIOS[params.ratio]} ${source ? 'border-blue-600 border-solid bg-black shadow-2xl scale-[1.02]' : 'border-gray-800 bg-[#0d1117] hover:border-blue-900 cursor-pointer shadow-inner'}`}
            >
              {!source ? (
                <div className="text-center group p-8">
                  <div className="w-16 h-16 bg-blue-600/5 rounded-full flex items-center justify-center mx-auto mb-4 transition-transform group-hover:scale-110">
                    <svg className="w-8 h-8 text-blue-900" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4" stroke-width="2" stroke-linecap="round"/></svg>
                  </div>
                  <p className="text-[10px] font-black text-gray-700 uppercase tracking-widest">Tap to Upload</p>
                </div>
              ) : (
                <img src={source} className="absolute inset-0 w-full h-full object-cover" alt="Source" />
              )}
              <input ref={fileInput} type="file" hidden onChange={onSelectFile} />
            </div>
          </div>

          {/* Ø§Ù„Ù…Ø±Ø¨Ø¹ 2: Ø§Ù„Ø±Ù†Ø¯Ø± Ø§Ù„Ø°ÙƒÙŠ */}
          <div className="space-y-4">
            <h3 className="text-[11px] font-black text-gray-600 uppercase tracking-[0.4em]">02. AI RENDERED OUTPUT</h3>
            <div className={`relative rounded-[2.5rem] lg:rounded-[3.5rem] border-2 border-gray-800 bg-[#0d1117] overflow-hidden flex items-center justify-center transition-all duration-700 ${ASPECT_RATIOS[params.ratio]} shadow-2xl`}>
              {isLoading && (
                <div className="absolute inset-0 z-50 bg-black/95 flex flex-col items-center justify-center p-8 text-center">
                  <div className="w-14 h-14 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-6"></div>
                  <p className="text-[10px] font-black text-blue-500 tracking-[0.5em] animate-pulse uppercase">Gemini AI: Processing Realism...</p>
                </div>
              )}
              
              {output ? (
                <>
                  <img src={output} className="absolute inset-0 w-full h-full object-cover" alt="Output" />
                  <div className="absolute inset-0 pointer-events-none flex items-center justify-center opacity-10 select-none">
                    <p className="rotate-[-25deg] text-3xl font-black text-red-600 uppercase">Avantgard Buildings</p>
                  </div>
                </>
              ) : (
                <div className="text-center opacity-5 tracking-[0.6em] text-[12px] font-black uppercase">
                  Rendering Window
                </div>
              )}
            </div>

            {output && !isLoading && (
              <a 
                href={output} 
                download="Avantgard-Pro-Render.png"
                className="w-full block bg-white text-black text-center py-5 rounded-[2rem] font-black text-xs hover:bg-gray-200 transition-all shadow-xl active:scale-95"
              >
                ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¯Ù‚Ø© 4K
              </a>
            )}
          </div>

        </div>
      </main>

    </div>
  );
}
